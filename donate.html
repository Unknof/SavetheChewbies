<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title data-i18n="donate.meta.title">Donate • Save The Chewbies</title>
    <meta
      name="description"
      content="Donate to Save the Children via Tiltify and support the Baby Chew fundraiser."
      data-i18n-attr-content="donate.meta.description"
    />

    <meta property="og:title" content="Donate • Save The Chewbies" data-i18n-attr-content="donate.meta.title" />
    <meta
      property="og:description"
      content="Donate to Save the Children via Tiltify and support the Baby Chew fundraiser."
      data-i18n-attr-content="donate.meta.description"
    />
    <meta property="og:image" content="./assets/icon.png" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Donate • Save The Chewbies" data-i18n-attr-content="donate.meta.title" />
    <meta
      name="twitter:description"
      content="Donate to Save the Children via Tiltify and support the Baby Chew fundraiser."
      data-i18n-attr-content="donate.meta.description"
    />
    <meta name="twitter:image" content="./assets/icon.png" />

    <link rel="icon" href="./assets/icon.png" type="image/png" />
    <link rel="apple-touch-icon" href="./assets/icon.png" />

    <link rel="stylesheet" href="./assets/styles.css" />
  </head>
  <body>
    <a class="skip-link" href="#main" data-i18n="common.skipToContent">Skip to content</a>

    <header class="site-header">
      <div class="container header-inner">
        <div class="brand">
          <div class="brand-mark" aria-hidden="true"><img src="./assets/icon.png" alt="" width="42" height="42" /></div>
          <div class="brand-text">
            <div class="brand-name" data-i18n="site.name">Save The Chewbies</div>
            <div class="brand-tagline" data-i18n="donate.brandTagline">Donate to Save the Children</div>
          </div>
        </div>

        <nav class="nav" aria-label="Primary">
          <a class="nav-link" href="./index.html" data-i18n="nav.home">Home</a>
          <a class="nav-link" href="./chew-story.html" data-i18n="nav.story">The True Story</a>
          <a class="nav-link" href="./gallery.html" data-i18n="nav.gallery">Gallery</a>
          <a class="nav-link nav-cta" href="./donate.html" aria-current="page" data-i18n="nav.donate">Donate</a>
          <a class="nav-link" href="./privacy.html" data-i18n="nav.privacy">Privacy</a>
          <a class="nav-link" href="./privacy.html#contact" data-i18n="nav.contact">Contact</a>
        </nav>
      </div>
    </header>

    <main id="main" class="container">
      <section class="page-header">
        <h1 data-i18n="donate.title">Donate</h1>
        <p class="lead">
          <span data-i18n="donate.lead">Help Save the Children and unlock in-game rewards!</span>
        </p>
      </section>

      <section class="card">
        <h2 data-i18n="donate.section.title">Donate to Save the Children</h2>
        <p>
          <span data-i18n="donate.section.body">Donations go directly through Tiltify's secure platform. Your contribution helps Save the Children and unlocks milestones below.</span>
        </p>
        <div class="actions">
          <a
            class="button"
            href="https://tiltify.com/@savethecewbies/savethechewbies-a-fundraiser-for-save-the-children"
            target="_blank"
            rel="noopener noreferrer"
            data-i18n="donate.section.cta"
          >Donate on Tiltify</a>
        </div>
        <p class="note">
          <span data-i18n="donate.section.note">This site does not handle payment information. Donations are processed securely by Tiltify.</span>
        </p>
      </section>

      <section class="card">
        <h2 id="incentives" data-i18n="donate.incentives.title">Incentives (milestones)</h2>
        <p>
          <span data-i18n="donate.incentives.body">To give donors extra motivation, we’re building five incentives tied to the Baby Chew in-game pet. Once the incentive list is finalized on Tiltify, it will be mirrored here.</span>
        </p>
        <p class="note" id="milestone-status" data-i18n="donate.incentives.loading">Milestones unlock in order. Loading current total…</p>
        <ul class="list" id="milestone-list">
          <li data-threshold="351" data-index="1" data-i18n-html="donate.m1.liHtml"><strong>€351 — Tantrum (knockback reaction):</strong> When Baby Chew gets knocked back, the baby chewbies throw a little tantrum (harmless / cosmetic).</li>
          <li data-threshold="702" data-index="2" data-i18n-html="donate.m2.liHtml"><strong>€702 — Playful sparring:</strong> Baby chewbies can have tiny harmless fights with other players’ baby chewbies.</li>
          <li data-threshold="702" data-index="3" data-i18n-html="donate.m3.liHtml"><strong>€702 — Ice caves (build process):</strong> Baby Chew occasionally builds ice caves with a fun build animation.</li>
          <li data-threshold="1053" data-index="4" data-i18n-html="donate.m4.liHtml"><strong>€1053 — Nydus teleport (fashionable):</strong> Baby Chew and the baby chewbies teleport to the current hero using the Nydus.</li>
          <li data-threshold="1404" data-index="5" data-i18n-html="donate.m5.liHtml"><strong>€1404 — Mecha Baby Chew (skin):</strong> A Mecha Baby Chew skin (like Mecha Chew, but for Baby Chew).</li>
        </ul>
        <p class="note">
          <span data-i18n="donate.incentives.note1">All milestones are listed here with their full descriptions.</span>
        </p>
        <p class="note">
          <span data-i18n="donate.incentives.note2">I’ll be streaming the implementation of these features (Discord, and bilibili if possible). Exact stream times will be posted on the site.</span>
        </p>
        <p class="note">
          <span data-i18n="donate.incentives.note3">Why €351? It comes from a Kerrigan Survival tournament on January 10–11 where players spawned a total of 351 baby chewbies.</span>
        </p>
        <figure style="margin:14px 0 0;">
          <img
            src="./assets/chewbieCountProof/Game1.jpg"
            alt="Tournament proof screenshot: Game 1"
            data-i18n-attr-alt="img.proof.game1Alt"
            style="max-width:100%;height:auto;border-radius:12px;display:block;"
            loading="lazy"
          />
          <figcaption class="note" style="margin-top:8px;" data-i18n="index.card.proof.game1">Proof screenshot (Game 1)</figcaption>
        </figure>

        <figure style="margin:14px 0 0;">
          <img
            src="./assets/chewbieCountProof/Game10.jpg"
            alt="Tournament proof screenshot: Game 10"
            data-i18n-attr-alt="img.proof.game10Alt"
            style="max-width:100%;height:auto;border-radius:12px;display:block;"
            loading="lazy"
          />
          <figcaption class="note" style="margin-top:8px;" data-i18n="index.card.proof.game10">Proof screenshot (Game 10)</figcaption>
        </figure>
        <p class="note">
          <span data-i18n="donate.incentives.creatorPledge">Creator pledge (proof of concept): I'll personally donate €10 for every Baby Chew used in the tournament (6 total → €60) to help kick things off.</span>
        </p>
      </section>

      <section class="card" id="privacy">
        <h2 data-i18n="donate.privacy.title">Privacy & contact</h2>
        <p>
          <span data-i18n-html="donate.privacy.bodyHtml">See <a href="./privacy.html">Privacy</a> for data-retention notes and <a href="./privacy.html#contact">Contact</a>.</span>
        </p>
      </section>

    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <div>
          <div class="footer-title" data-i18n="site.name">Save The Chewbies</div>
          <div class="footer-sub">© <span id="year"></span></div>
        </div>
        <div class="footer-links">
          <a class="nav-link" href="./privacy.html" data-i18n="footer.privacy">Privacy</a>
          <a class="nav-link" href="./privacy.html#contact" data-i18n="footer.contact">Contact</a>
          <a class="nav-link" href="./acknowledgements.html" data-i18n="footer.ack">Acknowledgements</a>
        </div>
      </div>
    </footer>

    <script src="./assets/i18n.js"></script>
    <script>
      document.getElementById('year').textContent = new Date().getFullYear();

      (function () {
        const I18N = window.STC_I18N;
        const t = I18N && typeof I18N.t === 'function' ? I18N.t : (k) => k;
        const intlLocale = I18N && typeof I18N.getIntlLocale === 'function' ? I18N.getIntlLocale() : undefined;
        const translateMilestoneName =
          I18N && typeof I18N.translateMilestoneName === 'function' ? I18N.translateMilestoneName : (name) => name;

        const statusEl = document.getElementById('milestone-status');
        const listEl = document.getElementById('milestone-list');
        if (!statusEl || !listEl) return;

        // Source of truth for milestone descriptions; used to fill gaps if Tiltify omits descriptions.
        const fallbackMilestones = [
          {
            amount: 351,
            name: t('donate.m1.name'),
            description: t('donate.m1.desc'),
          },
          {
            amount: 702,
            name: t('donate.m2.name'),
            description: t('donate.m2.desc'),
          },
          {
            amount: 702,
            name: t('donate.m3.name'),
            description: t('donate.m3.desc'),
          },
          {
            amount: 1053,
            name: t('donate.m4.name'),
            description: t('donate.m4.desc'),
          },
          {
            amount: 1404,
            name: t('donate.m5.name'),
            description: t('donate.m5.desc'),
          },
        ];

        function getItems() {
          return Array.from(listEl.querySelectorAll('li[data-threshold][data-index]'));
        }

        function fmtCurrency(value, currency) {
          try {
            return new Intl.NumberFormat(intlLocale, {
              style: 'currency',
              currency: currency || 'EUR',
              maximumFractionDigits: 0,
            }).format(value);
          } catch {
            return String(Math.round(value));
          }
        }

        function applyVisibility(total, currency, goal) {
          const items = getItems();
          if (items.length === 0) return;

          // Always show all items and clear any locked/unlocked styling.
          for (const li of items) {
            li.style.display = '';
            li.classList.remove('milestone-locked');
            li.classList.remove('milestone-unlocked');
          }

          const hasGoal = typeof goal === 'number' && Number.isFinite(goal) && goal > 0;
          const raisedText = hasGoal
            ? t('donate.incentives.statusRaisedOf', {
              total: fmtCurrency(Math.floor(total), currency),
              goal: fmtCurrency(Math.floor(goal), currency),
            })
            : t('donate.incentives.statusCurrentTotal', {
              total: fmtCurrency(Math.floor(total), currency),
            });

          statusEl.textContent = raisedText;
        }

        function showAll() {
          const items = getItems();
          for (const li of items) {
            li.style.display = '';
            li.classList.remove('milestone-locked');
            li.classList.remove('milestone-unlocked');
          }
        }

        async function loadMilestonesFromTiltify() {
          try {
            const r = await fetch('./incentives.php', { cache: 'no-store' });
            const data = await r.json();
            if (!data || data.ok !== true || !Array.isArray(data.milestones) || data.milestones.length === 0) {
              return;
            }

            const currency = typeof data.currency === 'string' ? data.currency : 'EUR';
            const milestones = data.milestones
              .map((m, i) => {
                const amount = typeof m.amount === 'number' ? m.amount : Number(m.amount);
                const name = typeof m.name === 'string' ? m.name : '';
                const description = typeof m.description === 'string' ? m.description : '';

                // Fill missing descriptions from fallback by position, then by name match.
                let resolvedDescription = description;
                if (!resolvedDescription) {
                  const fbByIndex = fallbackMilestones[i];
                  if (fbByIndex && fbByIndex.description) {
                    resolvedDescription = fbByIndex.description;
                  } else {
                    const fbMatch = fallbackMilestones.find((f) => f.name.toLowerCase() === name.toLowerCase());
                    if (fbMatch && fbMatch.description) {
                      resolvedDescription = fbMatch.description;
                    }
                  }
                }

                return {
                  name: translateMilestoneName(name),
                  description: resolvedDescription,
                  amount,
                };
              })
              .filter((m) => m.name && Number.isFinite(m.amount));

            if (milestones.length === 0) return;

            listEl.innerHTML = '';
            milestones.forEach((m, i) => {
              const li = document.createElement('li');
              li.setAttribute('data-threshold', String(m.amount));
              li.setAttribute('data-index', String(i + 1));

              const strong = document.createElement('strong');
              strong.textContent = `${fmtCurrency(m.amount, currency)} — ${m.name}: `;
              li.appendChild(strong);

              const descText = m.description || '';
              li.appendChild(document.createTextNode(descText));
              listEl.appendChild(li);
            });
          } catch {
            // Non-fatal; page has a fallback list.
          }
        }

        async function refresh() {
          try {
            const r = await fetch('./milestones.php', { cache: 'no-store' });
            const data = await r.json();
            if (!data || data.ok !== true || typeof data.total !== 'number') {
              statusEl.textContent = t('donate.incentives.totalUnavailable');
              showAll();
              return;
            }
            applyVisibility(
              data.total,
              typeof data.currency === 'string' ? data.currency : 'EUR',
              typeof data.goal === 'number' ? data.goal : NaN
            );
          } catch {
            statusEl.textContent = t('donate.incentives.totalUnavailable');
            showAll();
          }
        }

        // Load milestone definitions once; then start total refresh loop.
        loadMilestonesFromTiltify().finally(() => {
          refresh();
          setInterval(refresh, 30000);
        });
      })();
    </script>
    <script src="./assets/cookie-banner.js"></script>
  </body>
</html>
